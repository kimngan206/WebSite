<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Giỏ Hàng - AnhEm Motor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="index-style.css">
    <link rel="stylesheet" href="shoppingcart.css">

</head>

<body class="bg-gray-100 min-h-screen flex flex-col">
    <!-- Custom Modal for alerts/confirms (kept as is) -->
    <div id="custom-modal" class="custom-modal">
        <div class="custom-modal-content">
            <h3 id="custom-modal-title"></h3>
            <p id="custom-modal-message"></p>
            <div class="custom-modal-buttons">
                <button id="custom-modal-cancel" class="btn btn-secondary" style="display: none;">Hủy</button>
                <button id="custom-modal-ok" class="btn btn-primary">Đồng ý</button>
            </div>
        </div>
    </div>
    <div class="notification-container"></div>
    <header class="main-header">
        <div class="container">
            <div class="header-container">
                <button class="mobile-menu-toggle" id="mobileMenuToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <a href="index.html" class="logo">
                    <div class="logo-icon">
                        <img src="image/logo.png" alt="AnhEm Motor">
                    </div>
                    <span class="logo-text">AnhEm Motor</span>
                </a>
                <nav class="main-nav">
                    <ul>
                        <li><a href="index.html">Trang Chủ</a></li>
                        <li class="has-submenu">
                            <a href="listings.html">
                                Sản Phẩm <i class="fas fa-chevron-down"></i>
                            </a>
                            <ul class="submenu">
                                <li><a href="accessory.html">Nón Bảo Hiểm</a></li>
                                <li><a href="custome.html">Trang Phục</a></li>
                                <li><a href="chemicals.html">Hóa Chất</a></li>
                                <li><a href="spareparts.html">Phụ Tùng</a></li>
                            </ul>
                        </li>
                        <li><a href="about.html">Giới Thiệu</a></li>
                        <li><a href="news.html">Tin Tức-Sự Kiện</a></li>
                        <li><a href="promotion.html">Khuyến Mãi</a></li>
                        <li><a href="contact.html">Liên Hệ</a></li>
                        <li><a href="service.html">Dịch Vụ</a></li>
                    </ul>
                </nav>
                <div class="flex items-center space-x-4">
                    <a href="listings.html" class="text-gray-600 hover:text-red-500 transition duration-300">
                        <i class="fas fa-shopping-cart text-xl"></i>
                    </a>
                </div>
            </div>
        </div>
    </header>

    <main>
        <div class="cart-container-main">
            <h1 class="page-title">Giỏ hàng của bạn</h1>
            <div id="cart-content">
                <div class="cart-content">
                    <div class="cart-items">
                        <div class="cart-actions-top">
                            <button id="clear-cart-btn" class="clear-cart">
                                <i class="fas fa-trash-alt"></i> Xóa tất cả
                            </button>
                        </div>
                        <div id="cart-items-list" class="cart-items-list">
                        </div>
                    </div>
                    <div class="cart-summary">
                        <h3 class="text-xl font-semibold mb-4">Tóm tắt đơn hàng</h3>
                        <div class="summary-row">
                            <span class="text-gray-600">Tổng phụ:</span>
                            <span id="subtotal-summary">0 VNĐ</span>
                        </div>
                        <div class="summary-row">
                            <span class="text-gray-600">Phí vận chuyển:</span>
                            <span>0 VNĐ</span>
                        </div>
                        <div class="summary-row">
                            <span class="text-gray-600">Thuế (VAT):</span>
                            <span>0 VNĐ</span>
                        </div>
                        <div class="summary-row total">
                            <span>Tổng cộng:</span>
                            <span id="total-summary" class="text-honda-red">0 VNĐ</span>
                        </div>
                        <div class="checkout-actions">
                            <button id="checkout-btn" class="btn btn-primary">
                                <i class="fas fa-money-check-alt"></i> Tiến hành thanh toán
                            </button>
                            <a href="listings.html" class="btn btn-secondary">
                                <i class="fas fa-arrow-left"></i> Quay lại cửa hàng
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <div id="cart-empty" class="cart-empty hidden">
                <i class="fas fa-shopping-cart"></i>
                <h3>Giỏ hàng của bạn đang trống</h3>
                <p>Hãy khám phá các sản phẩm của chúng tôi và thêm vào giỏ hàng!</p>
                <a href="listings.html" class="continue-shopping">Tiếp tục mua sắm</a>
            </div>
        </div>
    </main>

    <!-- Payment Modal -->
    <div id="payment-modal" class="modal">
        <div class="modal-content">
            <span id="payment-close-btn" class="close-btn">&times;</span>
            <h3 class="text-2xl font-bold mb-4">Chọn phương thức thanh toán</h3>

            <div class="payment-methods-list">
                <div class="payment-method" data-method="cod">
                    <i class="fas fa-handshake"></i>
                    <p class="font-semibold">Thanh toán khi nhận hàng (COD)</p>
                </div>
                <div class="payment-method" data-method="bank-transfer">
                    <i class="fas fa-university"></i>
                    <p class="font-semibold">Chuyển khoản ngân hàng</p>
                </div>
            </div>

            <div id="cod-info" class="payment-info">
                <p>Bạn sẽ thanh toán tiền mặt cho nhân viên giao hàng khi nhận được sản phẩm.</p>
            </div>
            <div id="bank-transfer-info" class="payment-info">
                <p class="font-bold">Thông tin chuyển khoản:</p>
                <p><strong>Ngân hàng:</strong> Vietcombank</p>
                <p><strong>Số tài khoản:</strong> 0123456789</p>
                <p><strong>Chủ tài khoản:</strong> Cong ty TNHH AnhEm Motor</p>
                <p><strong>Nội dung:</strong> [Tên bạn] - TT Don hang #[Số đơn hàng]</p>
            </div>

            <button id="confirm-payment-btn" class="confirm-payment-btn">Xác nhận thanh toán</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const cartItemsList = document.getElementById('cart-items-list');
            const subtotalSummary = document.getElementById('subtotal-summary');
            const totalSummary = document.getElementById('total-summary');
            const cartContent = document.getElementById('cart-content');
            const cartEmpty = document.getElementById('cart-empty');
            const clearCartBtn = document.getElementById('clear-cart-btn');
            const checkoutBtn = document.getElementById('checkout-btn');
            const paymentModal = document.getElementById('payment-modal');
            const paymentCloseBtn = document.getElementById('payment-close-btn');
            const paymentMethods = document.querySelectorAll('.payment-method');
            const paymentInfos = document.querySelectorAll('.payment-info');
            const confirmPaymentBtn = document.getElementById('confirm-payment-btn');
            const customModal = document.getElementById('custom-modal');
            const customModalTitle = document.getElementById('custom-modal-title');
            const customModalMessage = document.getElementById('custom-modal-message');
            const customModalOkBtn = document.getElementById('custom-modal-ok');
            const notificationContainer = document.querySelector('.notification-container');

            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            let currentOrderId = 'AE' + Math.floor(Math.random() * 100000);

            // Function to show custom notification
            function showNotification(message, type = 'success') {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.textContent = message;
                notificationContainer.appendChild(notification);

                setTimeout(() => {
                    notification.style.animation = 'slideOut 0.3s ease-in-out forwards';
                }, 3000); // 3 seconds before sliding out

                setTimeout(() => {
                    notification.remove();
                }, 3300); // Remove after animation
            }

            // Function to show custom modal for alerts
            function showCustomModal(title, message) {
                customModalTitle.textContent = title;
                customModalMessage.textContent = message;
                customModal.style.display = 'flex';
                customModalOkBtn.onclick = () => {
                    customModal.style.display = 'none';
                };
            }

            function renderCart() {
                if (cart.length === 0) {
                    cartContent.classList.add('hidden');
                    cartEmpty.classList.remove('hidden');
                } else {
                    cartContent.classList.remove('hidden');
                    cartEmpty.classList.add('hidden');
                    cartItemsList.innerHTML = cart.map(item => `
                        <div class="cart-item" data-id="${item.id}">
                            <div class="item-image">
                                <img src="${item.image}" alt="${item.name}">
                            </div>
                            <div class="item-details">
                                <h4 class="item-name">${item.name}</h4>
                                <p class="item-price">Mã: ${item.code}</p>
                                <p class="item-price">${(item.price).toLocaleString('vi-VN')} VNĐ</p>
                                <div class="quantity-controls">
                                    <button class="quantity-btn decrease-btn" data-id="${item.id}">-</button>
                                    <span class="quantity-display">${item.quantity}</span>
                                    <button class="quantity-btn increase-btn" data-id="${item.id}">+</button>
                                </div>
                            </div>
                            <p class="font-semibold text-xl text-honda-red">${(item.price * item.quantity).toLocaleString('vi-VN')} VNĐ</p>
                            <button class="remove-item" data-id="${item.id}">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    `).join('');
                }
                updateCartSummary();
            }

            function updateCartSummary() {
                const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                subtotalSummary.textContent = `${subtotal.toLocaleString('vi-VN')} VNĐ`;
                totalSummary.textContent = `${subtotal.toLocaleString('vi-VN')} VNĐ`;
            }

            function saveCart() {
                localStorage.setItem('cart', JSON.stringify(cart));
            }

            // Event listener for quantity changes and item removal
            cartItemsList.addEventListener('click', (e) => {
                const target = e.target;
                const itemId = target.closest('[data-id]')?.dataset.id;
                if (!itemId) return;

                const itemIndex = cart.findIndex(item => item.id == itemId);
                if (itemIndex === -1) return;

                if (target.closest('.increase-btn')) {
                    cart[itemIndex].quantity++;
                } else if (target.closest('.decrease-btn')) {
                    if (cart[itemIndex].quantity > 1) {
                        cart[itemIndex].quantity--;
                    } else {
                        // Use custom modal for confirmation before removing last item
                        showCustomModal(
                            'Xác nhận xóa',
                            'Bạn có chắc chắn muốn xóa sản phẩm này khỏi giỏ hàng?'
                        );
                        document.getElementById('custom-modal-cancel').style.display = 'inline-block';
                        document.getElementById('custom-modal-ok').onclick = () => {
                            cart.splice(itemIndex, 1);
                            saveCart();
                            renderCart();
                            customModal.style.display = 'none';
                            document.getElementById('custom-modal-cancel').style.display = 'none';
                        };
                        document.getElementById('custom-modal-cancel').onclick = () => {
                            customModal.style.display = 'none';
                            document.getElementById('custom-modal-cancel').style.display = 'none';
                        };
                        return;
                    }
                } else if (target.closest('.remove-item')) {
                    // Use custom modal for confirmation
                    showCustomModal(
                        'Xác nhận xóa',
                        'Bạn có chắc chắn muốn xóa sản phẩm này khỏi giỏ hàng?'
                    );
                    document.getElementById('custom-modal-cancel').style.display = 'inline-block';
                    document.getElementById('custom-modal-ok').onclick = () => {
                        cart.splice(itemIndex, 1);
                        saveCart();
                        renderCart();
                        customModal.style.display = 'none';
                        document.getElementById('custom-modal-cancel').style.display = 'none';
                    };
                    document.getElementById('custom-modal-cancel').onclick = () => {
                        customModal.style.display = 'none';
                        document.getElementById('custom-modal-cancel').style.display = 'none';
                    };
                    return;
                }

                saveCart();
                renderCart();
            });

            // Clear all items from cart
            clearCartBtn.addEventListener('click', () => {
                showCustomModal(
                    'Xác nhận xóa tất cả',
                    'Bạn có chắc chắn muốn xóa tất cả sản phẩm khỏi giỏ hàng?'
                );
                document.getElementById('custom-modal-cancel').style.display = 'inline-block';
                document.getElementById('custom-modal-ok').onclick = () => {
                    cart = [];
                    saveCart();
                    renderCart();
                    customModal.style.display = 'none';
                    document.getElementById('custom-modal-cancel').style.display = 'none';
                };
                document.getElementById('custom-modal-cancel').onclick = () => {
                    customModal.style.display = 'none';
                    document.getElementById('custom-modal-cancel').style.display = 'none';
                };
            });

            // Handle payment modal
            checkoutBtn.addEventListener('click', () => {
                if (cart.length === 0) {
                    showNotification("Giỏ hàng của bạn đang trống. Vui lòng thêm sản phẩm để thanh toán.", "error");
                    return;
                }
                paymentModal.style.display = 'flex';
            });

            paymentCloseBtn.addEventListener('click', () => {
                paymentModal.style.display = 'none';
            });

            window.addEventListener('click', (e) => {
                if (e.target == paymentModal) {
                    paymentModal.style.display = 'none';
                }
            });

            // Handle payment method selection
            paymentMethods.forEach(method => {
                method.addEventListener('click', () => {
                    paymentMethods.forEach(m => m.classList.remove('selected'));
                    method.classList.add('selected');

                    paymentInfos.forEach(info => info.classList.remove('active'));
                    const methodType = method.dataset.method;
                    document.getElementById(`${methodType}-info`).classList.add('active');
                });
            });

            // Handle confirmation of payment
            confirmPaymentBtn.addEventListener('click', () => {
                const selectedMethod = document.querySelector('.payment-method.selected');
                if (!selectedMethod) {
                    showNotification("Vui lòng chọn một phương thức thanh toán.", "error");
                    return;
                }

                // Simulate payment success
                paymentModal.style.display = 'none';
                cart = [];
                saveCart();
                renderCart();
                showNotification("Thanh toán thành công! Cảm ơn bạn đã mua hàng.");
            });

            renderCart();
        });
    </script>
</body>

</html>